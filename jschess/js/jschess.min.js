function bB(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n        <g\n          fill="none"\n          fillRule="evenodd"\n          stroke="#000"\n          strokeWidth="1.5"\n          strokeLinecap="round"\n          strokeLinejoin="round">\n          <g fill="#000" strokeLinecap="butt">\n            <path d="M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2z" />\n            <path d="M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z" />\n            <path d="M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z" />\n          </g>\n          <path d="M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5" stroke="#fff" strokeLinejoin="miter" />\n        </g>\n      </svg>`}function bK(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n        <g\n          fill="none"\n          fillRule="evenodd"\n          stroke="#000"\n          strokeWidth="1.5"\n          strokeLinecap="round"\n          strokeLinejoin="round">\n          <path d="M22.5 11.63V6" strokeLinejoin="miter" />\n          <path\n            d="M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5"\n            fill="#000"\n            strokeLinecap="butt"\n            strokeLinejoin="miter"\n          />\n          <path\n            d="M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z"\n            fill="#000"\n          />\n          <path d="M20 8h5" strokeLinejoin="miter" />\n          <path\n            d="M32 29.5s8.5-4 6.03-9.65C34.15 14 25 18 22.5 24.5l.01 2.1-.01-2.1C20 18 9.906 14 6.997 19.85c-2.497 5.65 4.853 9 4.853 9"\n            stroke="#fff"\n          />\n          <path\n            d="M11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0"\n            stroke="#fff"\n          />\n        </g>\n      </svg>`}function bN(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <g>\n        <path\n        d="M36 36c-3.385-.972-10.115.43-13.5-2-3.385 2.43-10.115 1.028-13.5 2 0 0-1.646.542-3 2 .677.972 1.646.986 3 .5 3.385-.972 10.115.458 13.5-1 3.385 1.458 10.115.028 13.5 1 1.354.486 2.323.472 3-.5-1.354-1.945-3-2-3-2z"\n        fillRule="evenodd"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinejoin="round"\n        />\n        <path\n        d="M30 32c-2.5 2.5-12.5 2.5-15 0-.5-1.5 0-2 0-2h15s.5.5 0 2z"\n        fillRule="evenodd"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinejoin="round"\n        />\n        <path d="M30 30H15" fill="none" stroke="#000" strokeWidth="1.5" />\n        <g strokeLinecap="round">\n        <path\n            d="M20.344 7.627c8.037.765 12.63 6.123 12.247 22.197H14.987c0-6.89 7.654-4.975 6.124-16.074"\n            fillRule="evenodd"\n            stroke="#000"\n            strokeWidth="1.14813"\n        />\n        <path\n            d="M21.875 13.75c.294 2.228-4.25 5.64-6.123 6.89-2.297 1.53-2.158 3.323-3.827 3.06-.798-.722 1.08-2.325 0-2.296-.766 0 .143.943-.766 1.53-.766 0-3.065.766-3.063-3.06 0-1.53 4.593-9.186 4.593-9.186s1.443-1.456 1.53-2.68c-.555-.76-.382-1.53-.382-2.295.765-.765 2.296 1.914 2.296 1.914h1.53s.6-1.525 1.915-2.297c.764 0 .764 2.297.764 2.297"\n            fillRule="evenodd"\n            stroke="#000"\n            strokeWidth="1.14813"\n            strokeLinejoin="round"\n        />\n        <path\n            d="M10.776 19.49a.383.383 0 1 1-.765 0 .383.383 0 1 1 .766 0zM14.935 12.028a.383 1.148 30 1 1-.663-.383.383 1.148 30 1 1 .663.383z"\n            stroke="#fff"\n            strokeWidth="1.14813"\n            strokeLinejoin="round"\n        />\n        <path\n            d="M31.825 29.824c.766-15.31-4.21-21.05-9.185-21.815"\n            fillRule="evenodd"\n            stroke="#fff"\n            strokeWidth=".76542"\n        />\n        </g>\n        <path\n        d="M15 30h15"\n        stroke="#fff"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        strokeLinejoin="round"\n        />\n    </g>\n    </svg>`}function bP(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%" >\n    <path\n        d="M22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n    />\n    </svg>`}function bQ(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">    \n      <g\n          fill="#000"\n          fillRule="evenodd"\n          stroke="#000"\n          strokeWidth="1.5"\n          strokeLinecap="round"\n          strokeLinejoin="round">\n          <path d="M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z"  />\n          <path\n          d="M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-14V25L7 14l2 12z"\n          strokeLinecap="butt" stroke="#fff" strokeWidth = '0.7'\n          />\n          \n          <path\n          d="M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z"\n          strokeLinecap="butt" stroke="#fff" strokeWidth = '0.9'\n          />\n          <path d="M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0" fill="#fff" stroke="#fff" strokeWidth = '0.9'/>\n      </g>\n    </svg>`}function bR(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <g\n        fill={0} \n        fillRule="evenodd"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        strokeLinejoin="round">\n        <path\n        d="M9 39h27v-3H9v3zM12.5 32l1.5-2.5h17l1.5 2.5h-20zM12 36v-4h21v4H12z"\n        strokeLinecap="butt"\n        />\n        <path d="M14 29.5v-13h17v13H14z" strokeLinecap="butt" strokeLinejoin="miter" />\n        <path\n        d="M14 16.5L11 14h23l-3 2.5H14zM11 14V9h4v2h5V9h5v2h5V9h4v5H11z"\n        strokeLinecap="butt"\n        />\n        <path\n        d="M12 35.5h21M13 31.5h19M14 29.5h17M14 16.5h17M11 14h23"\n        fill="none"\n        stroke="#fff"\n        strokeWidth={1}\n        strokeLinejoin="miter"\n        />\n    </g>\n    </svg>`}function wB(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <g\n        fill="none"\n        fillRule="evenodd"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        strokeLinejoin="round">\n        <g fill="#fff" strokeLinecap="butt">\n        <path d="M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2z" />\n        <path d="M15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z" />\n        <path d="M25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z" />\n        </g>\n        <path d="M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5" strokeLinejoin="miter" />\n    </g>\n    </svg>`}function wK(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n      <g\n          fill="none"\n          fillRule="evenodd"\n          stroke="#000"\n          strokeWidth="1.5"\n          strokeLinecap="round"\n          strokeLinejoin="round">\n          <path d="M22.5 11.63V6M20 8h5" strokeLinejoin="miter" />\n          <path\n          d="M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5"\n          fill="#fff"\n          strokeLinecap="butt"\n          strokeLinejoin="miter"\n          />\n          <path\n          d="M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z"\n          fill="#fff"\n          />\n          <path d="M11.5 30c5.5-3 15.5-3 21 0M11.5 33.5c5.5-3 15.5-3 21 0M11.5 37c5.5-3 15.5-3 21 0" />\n      </g>\n      </svg>`}function wN(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <g\n        fill="none"\n        fillRule="evenodd"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        strokeLinejoin="round">\n        <path d="M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21" fill="#fff" />\n        <path\n        d="M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3"\n        fill="#fff"\n        />\n        <path d="M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0z" fill="#000" />\n        <path\n        d="M14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z"\n        fill="#000"\n        strokeWidth="1.49997"\n        />\n    </g>\n    </svg>`}function wP(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <path\n        d="M22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z"\n        fill="#fff"\n        stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        {...props}\n    />\n    </svg>`}function wQ(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    \n    \n    <g\n        fill="#fff"\n        fillRule="evenodd"\n        // stroke="#000"\n        strokeWidth="1.5"\n        strokeLinecap="round"\n        strokeLinejoin="round">\n        <path d="M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z" />\n        <path\n        d="M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-14V25L7 14l2 12z"\n        strokeLinecap="butt"\n        stroke="#00000" \n        />\n        <path\n        d="M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z"\n        strokeLinecap="butt"\n        />\n        <path d="M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0" fill="none" />\n    </g>\n    </svg>`}function wR(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n      <g\n          fill="#fff"\n          fillRule="evenodd"\n          stroke="#000"\n          strokeWidth="1.5"\n          strokeLinecap="round"\n          strokeLinejoin="round">\n          <path\n          d="M9 39h27v-3H9v3zM12 36v-4h21v4H12zM11 14V9h4v2h5V9h5v2h5V9h4v5"\n          strokeLinecap="butt"\n          />\n          <path d="M34 14l-3 3H14l-3-3" />\n          <path d="M31 17v12.5H14V17" strokeLinecap="butt" strokeLinejoin="miter" />\n          <path d="M31 29.5l1.5 2.5h-20l1.5-2.5" />\n          <path d="M11 14h23" fill="none" strokeLinejoin="miter" />\n      </g>\n      </svg>`}function no_piece(t){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45" width=${t.size} height="100%">\n    <g>\n    </g>\n  </svg>`}function piece_svg(t,e){return __PIECE_FN_SVG[t]({size:e})}const __PIECE_FN_SVG=[wK,wQ,wR,wB,wN,wP,no_piece,no_piece,bK,bQ,bR,bB,bN,bP,no_piece,no_piece],SVG={piece_svg:piece_svg},constant={bw_cname:{0:"white-square",1:"black-square",black:"black-square",white:"white-square","black-square":"black-square","white-square":"white-square"},FILE:["A","B","C","D","E","F","G","H"]},redox="./images/redo_icon.svg",undox="./images/undo_icon.svg",blank="./images/blank.svg";var config={WHITE:"#f8ecec",BLACK:"#ffa500",HIGHLIGHT:"#646400",CONTROLLER:{redo:redox,undo:undox,blank:blank},SQ_SIZE:10,BOARD:null,set_sq_size:function(t=null){if(typeof t==Number)console.log("Number got : ",typeof t),config.SQ_SIZE=t;else if(t.constructor==Object&&t.id&&"string"==typeof t.id){var e=get.divheight(t.id),i=get.divwidth(t.id);H=get.bodyheight(),W=get.bodywidth(),l=e>i?parseInt(W/8):parseInt(e/8),config.SQ_SIZE=l}},set_black_white:function(t){t.constructor==Object&&t.black&&t.white&&"string"==typeof t.black&&"string"==typeof t.black&&match.iscolor(t.black)&&match.iscolor(t.white)&&(config.BLACK=t.black,config.WHITE=t.white)}};class converter{static vh2px(t){var e=window,i=document,_=i.documentElement,s=i.getElementsByTagName("body")[0];e.innerWidth||_.clientWidth||s.clientWidth;return(e.innerHeight||_.clientHeight||s.clientHeight)*t/100}static vw2px(t){var e=window,i=document,_=i.documentElement,s=i.getElementsByTagName("body")[0],n=e.innerWidth||_.clientWidth||s.clientWidth;e.innerHeight||_.clientHeight||s.clientHeight;return n*t/100}static percent2px(t,e="chess-board"){var i=document.getElementById(e);return{x:i.clientWidth*t/100,y:i.clientHeight*t/100}}}class get{static bodyheight(){var t=document;t.documentElement;return t.getElementsByTagName("body")[0].clientHeight}static bodywidth(){var t=document;t.documentElement;return t.getElementsByTagName("body")[0].clientWidth}static divheight(t){var e=document.getElementById(t);if(e)return e.offsetHeight}static divwidth(t){var e=document.getElementById(t);if(e)return e.offsetWidth}}class match{static iscolor(){return/^#[0-9A-F]{6}$/i.test("#AABBCC")}}class query{static baseclass(t){if(t instanceof Function){let e=t;for(;e;){const t=Object.getPrototypeOf(e);if(!t||t===Object||!t.name)break;e=t}return e}}static allinstances(t){var e=query.baseclass(t);console.log(e,e.instances)}}objects={add:function(t){var e=query.baseclass(t.constructor);e.name in objects?objects[e.name].push(t):objects[e.name]=[t]}};class State{constructor(t){this.board=t||null,this.sq_n=null,this.valid_moves=[],this.clicked=!1,this.movenow=!1,this.update=!1,this.cntrl={type:"nan"}}get(){return this.clicked=!this.clicked,this}move(){return this.contains(this.sq_n)?this.movenow=!0:this.movenow=!1,this.movenow}contains(t){return this.valid_moves.map(t=>this.x88_sq_id({r:t.y,f:t.x})).includes(this.x88_sq_id(t))}set_cntrl(t){this.cntrl.type=t}set_board(t){return this.board=t,this}set_sq_n(t){this.clicked=!0,this.sq_n=t}set_valid_moves(t){this.clicked=!0,this.valid_moves=t}set(t,e){this.clicked=!0,this.valid_moves=e,this.sq_n=t}x88_sq_id(t){return t?t.r<<4|t.f:null==this.sq_n?null:this.sq_n.r<<4|this.sq_n.f}}const games=[];class Click{static clicked_square(t,e,i=0){console.log("square clicked : id ",t,e),games[i].config.BOARD.ui_board[t][e].clicked_square(),games[i].config.BOARD.clicked_board()}static clicked_board(){console.log("board clicked")}}const version="0.1.0",__PIECES_STD=[];__PIECES_STD.wK=0,__PIECES_STD.wQ=1,__PIECES_STD.wR=2,__PIECES_STD.wB=3,__PIECES_STD.wN=4,__PIECES_STD.wP=5,__PIECES_STD.X=6,__PIECES_STD.bK=8,__PIECES_STD.bQ=9,__PIECES_STD.bR=10,__PIECES_STD.bB=11,__PIECES_STD.bN=12,__PIECES_STD.bP=13;const __PIECES_ID=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],BOARD_MASK=8,PIECE_MASK=15,PIECE_INFO_MASK=127,PIECE_INFO_BITS=7,PIECE_BITS=4,x88_MASK=127,x88_MOVE_BITS=14,x88_MOVE_MASK=16383,x88_BITS=7,DEAD=8,DIR_OFF_INV=0,EMPTY_SQ_TYPE=2,EMPTY_SQ=6,INVALID_SQ=7,__RANGE={KING:1,QUEEN:8,ROOK:8,BISHOP:8,HORSE:1,PAWN:1,DEFAULT:8},__BORANK=[[0,1],[7,6]],__RANGE_ARR=[1,8,8,8,1,1,8,0,1,8,8,8,1,1,8,0],__DIRECTION={KING:[0,2,4,6,8,10,12,14],QUEEN:[0,2,4,6,8,10,12,14],ROOK:[0,4,8,12],BISHOP:[2,6,10,14],HORSE:[1,3,5,7,9,11,13,15],PAWN:[2,4,6],DEFAULT:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},__DIR_LENGTH={KING:8,QUEEN:8,ROOK:4,BISHOP:4,HORSE:8,PAWN:3,DEFAULT:16},__HORSE_MOVES_OFFSET=[18,33,31,14,-18,-33,-31,-14],__DIR_OFFFSET_M={KING:[1,0,17,0,16,0,15,0,-1,0,-17,0,-16,0,-15,0],QUEEN:[1,0,17,0,16,0,15,0,-1,0,-17,0,-16,0,-15,0],ROOK:[1,0,0,0,16,0,0,0,-1,0,0,0,-16,0,0,0],BISHOP:[0,0,17,0,0,0,15,0,0,0,-17,0,0,0,-15,0],HORSE:[0,18,0,33,0,31,0,14,0,-18,0,-33,0,-31,0,-14],PAWN:[0,0,17,0,16,0,15,0,0,0,0,0,0,0,0],DEFAULT:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},__DIR_OFFFSET={KING:[1,17,16,15,-1,-17,-16,-15],QUEEN:[1,17,16,15,-1,-17,-16,-15],ROOK:[1,16,-1,-16],BISHOP:[17,15,-17,-15],HORSE:[18,33,31,14,-18,-33,-31,-14],PAWN:[0,17,16,15],DEFAULT:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},__DIR_OFFFSET_ARR=[__DIR_OFFFSET.KING,__DIR_OFFFSET.QUEEN,__DIR_OFFFSET.ROOK,__DIR_OFFFSET.BISHOP,__DIR_OFFFSET.HORSE,__DIR_OFFFSET.PAWN,__DIR_OFFFSET.DEFAULT,[],__DIR_OFFFSET.KING,__DIR_OFFFSET.QUEEN,__DIR_OFFFSET.ROOK,__DIR_OFFFSET.BISHOP,__DIR_OFFFSET.HORSE,__DIR_OFFFSET.PAWN,__DIR_OFFFSET.DEFAULT,[]],__P_RANK=[1,6],__DIRECTION_ARR=[__DIRECTION.KING,__DIRECTION.QUEEN,__DIRECTION.ROOK,__DIRECTION.BISHOP,__DIRECTION.HORSE,__DIRECTION.PAWN,__DIRECTION.DEFAULT,[],__DIRECTION.KING,__DIRECTION.QUEEN,__DIRECTION.ROOK,__DIRECTION.BISHOP,__DIRECTION.HORSE,__DIRECTION.PAWN,__DIRECTION.DEFAULT,[]],__PIECE_VALUE=[1048756,127,64,47,47,23,0,0,-1048756,-127,-64,-47,-47,-23,0,0],PIECE_VALUE_MASK=511,__PIECE_SQ=null,__PIECE_INFL=[1,3,5,7,7,9,0,0,513,515,517,519,519,521,0,0],__PIECE=["wK","wQ","wR","wB","wN","wP","X","RE","bK","bQ","bR","bB","bN","bP","X","RE"],__CLASSIC=[["wR","wN","wB","wQ","wK","wB","wN","wR"],["wP","wP","wP","wP","wP","wP","wP","wP"],["X","X","X","X","X","X","X","X"],["X","X","X","X","X","X","X","X"],["X","X","X","X","X","X","X","X"],["X","X","X","X","X","X","X","X"],["bP","bP","bP","bP","bP","bP","bP","bP"],["bR","bN","bB","bQ","bK","bB","bN","bR"]],__x88=[2,4,3,1,0,3,4,2,0,1,2,3,4,5,6,7,5,5,5,5,5,5,5,5,16,17,18,19,20,21,22,23,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,13,13,13,13,13,13,13,13,96,97,98,99,100,101,102,103,10,12,11,9,8,11,12,10,112,113,114,115,116,117,118,119],__STANDARD=[["A","B","C","D","E","F","G","H"],["1","2","3","4","5","6","7","8"]],__BTYPE_MOD=[];__BTYPE_MOD.x88=16,__BTYPE_MOD.NORMAL=8;const __STYLE=[];__STYLE.CLASSIC=__CLASSIC;const FUNCTION_START="__________________________________________________\nProcess Start\n__________________________________________________",FUNCTION_END="__________________________________________________\nProcess End\n__________________________________________________";class Piece{constructor(t){if("string"==typeof t){if(!__PIECE.includes(t))return;this.piece_id=__PIECES_STD[t],this.name=t}else if("number"==typeof t){if(!__PIECES_ID.includes(t))return;this.piece_id=t,this.name=__PIECE[t]}}update_piece_id(t){if("number"==typeof t){if(t&=15,!__PIECES_ID.includes(t))return;this.piece_id=t,this.name=__PIECE[t]}}}class Square{static x88sqno(t,e){return(t<<4)+e&127}static x88_v40sqno(t){var e={x:t%16,y:Math.floor(t/16)};if(e.y>7)throw ErrorEvent("Invalid Parameters");return e}static sq_name(t,e=null,i="NORMAL"){if(null==e){var _=__BTYPE_MOD[i];e=t%_,t=Math.floor(t/_)}return __STANDARD[0][e]+__STANDARD[1][t]}constructor(t,e,i,_=0){this.sq={x:e,y:t},this.name=this.sq_name(t,e),this.piece=i,this.attack_flag=_}sq_name(t,e=null,i="NORMAL"){if(null==e){var _=__BTYPE_MOD[i];t%=_,e=Math.floor(e/_)}return __STANDARD[0][e]+__STANDARD[1][t]}set_piece_id(t){}static sq_color(t,e,i="NORMAL"){return~(1&t^1&e)}sq_color(t="NORMAL"){return 1&~(1&this.sq.x^1&this.sq.y)}}class Board{constructor(t="CLASSIC"){this.board=array2D(8,8),this.style=t,this.init(),this.v_moves=[],this.engine=new Engine,this.computer=0}init(){for(var t=0;t<8;t++)for(var e=0;e<8;e++)this.board[t][e]=new Square(t,e,new Piece(__STYLE[this.style][t][e]))}get_piece(t,e){return this.board[e][t].piece_id}get_square(t,e){return this.board[e][t]}clear_flag(t=null){t&&this.v_moves.forEach(t=>{this.board[t.x][t.y].attack_flag=0})}valid_moves(t,e){this.clear_flag(this.v_moves);var i=this.engine.valid_moves(Square.x88sqno(e,t),null,this.engine.turn,!0);return this.v_moves=this.to_visual_array(i),this.v_moves.forEach(t=>{this.board[t.x][t.y].attack_flag=1}),this.v_moves}move_black(){var t=new Engine(this.engine.EB,1).next_move(null,null,2);return console.log("sq : ",t),t}move(t,e,i=0){var _=this.engine.move(Square.x88sqno(e,t),null,this.val_moves);return this.update(),_}next_move(t,e){var i=this.engine.next_move(Square.x88sqno(e,t),null,1,this.engine.turn);return this.engine.sq_n=i.sq_n,this.engine.move(i.n_sq_n,null,null,!0),i}update(){for(var t=0;t<128;t++){var e=Square.x88_v40sqno(t);e.x<8&&this.board[e.y][e.x].piece.update_piece_id(this.engine.EB[t])}}cntrl(t){"undo"==t?this.engine.undo():"redo"==t?this.engine.redo():"undoone"==t&&this.engine.undo_one(),this.update()}to_visual_array(t){for(var e=[],i=0;i<t.length;i++)e.push(Square.x88_v40sqno(t[i]));return e}to_engine_board(){for(var t=array2D(8,16,0),e=0;e<8;e++)for(var i=0;i<8;i++)t[Square.x88sqno(e,i)]=i<<4|this.board[e][i].piece.piece_id;return t}}class Engine{constructor(t,e=0){null!=t?this.EB=[...t]:this.init(),this.p_sq_n=null,this.n_p_sq_n=null,this.sq_n=null,this.val_moves=[],this.hist_move=[],this.future_move=[],this.computer=1,this.turn=e}init(){this.EB=Array(128).fill(0);for(var t=0;t<128;t++){var e=15&t;this.EB[t]=e<8?e<<4|__x88[t]:__x88[t]}this.turn=0}init_pieces(){for(var t=0;t<128;t++){var e=15&t;this.piece_area(t)&&(this.EB[t]=e<<4|__x88[t])}this.turn=0}init_sq(){for(var t=0;t<128;t++)this.piece_area(t)||(this.EB[t]=__x88[t]);this.turn=0}set(t){this.EB=t.to_engine_board()}rank(t){return isFinite(t)&&this.piece_area(t)?t>>4:null}invert(t,e=0){return e?~t&1<<e-1:7&~t}piece_area(t){return 0==(t&BOARD_MASK)}on_board(t){return t>=0&&t<128}_x(t){return isFinite(t)&&this.piece_area(t)?7&t:-1}_y(t){return isFinite(t)&&this.piece_area(t)?t>>>4:-1}set_piece(t,e){var i=15&e;return t&=127,this.EB[t]|=i,this.EB[t]}haves_piece(t,e=3){if(!this.piece_area(t))return!1;var i=15&this.EB[t];return 1==e?i>7&&i<14:0==e?i>-1&&i<6:(1==(e=1)||0==e)&&(i>-1&&i<6||i>7&&i<14)}move_encode(t,e){return((t&x88_MASK)<<PIECE_INFO_BITS|this.EB[t]&PIECE_INFO_MASK)<<x88_MOVE_BITS|(e&x88_MASK)<<PIECE_INFO_BITS|this.EB[e]&PIECE_INFO_MASK}move_decode(t){return[[t>>x88_MOVE_BITS+PIECE_INFO_BITS&x88_MASK,t>>x88_MOVE_BITS&PIECE_INFO_MASK],[t>>PIECE_INFO_BITS&x88_MASK,t&PIECE_INFO_MASK]]}piece(t,e=!1){return e?15&this.EB[t]:7&this.EB[t]}pl_type(t){return this.on_board(t)?this.haves_piece(t,1)?1:this.haves_piece(t,0)?0:this.piece_area(t)?2:3:3}move_nen(t,e,i=null){if(!e){var _=t;t=e||this.sq_n,e=_}if(console.log("sq_n",t," n_sq_n : ",e,!this.sq_n||t==e),this.sq_n&&t!=e&&(console.log("val _ moves  : ",this.val_moves),this.val_moves.length==[].length||(i=this.val_moves,console.log("valid_moves",i,t,!i.includes(e)),i.includes(e)))){this.val_moves=[],this.p_sq_n=[t,this.EB[t]],this.n_p_sq_n=[e,this.EB[e]],this.hist_move.push(this.move_encode(t,e)),console.log("hist kmoves : ",this.hist_move);var s=(__BORANK[this.pl_type(t)][this.piece(t)<5?0:1]<<4)+(this.EB[t]>>4&7);this.EB[s]=t,0!=this.pl_type(e)&&1!=this.pl_type(e)||(s=(__BORANK[this.pl_type(e)][this.piece(e)<5?0:1]<<4)+(this.EB[e]>>4&7),this.EB[s]=e),this.EB[e]=this.EB[this.sq_n],this.EB[t]=EMPTY_SQ,this.sq_n=e}}move(t,e,i=null,_=!1){if(!e){var s=t;t=this.sq_n,e=s}if(i||(i=this.val_moves),!t||t==e)return!1;if(!this.piece_area(t)||!this.piece_area(e))return!1;if(this.pl_type(e)==this.pl_type(t))return!1;if(this.pl_type(t)==this.invert(this.turn,1))return!1;if(!t)return!1;if(!_&&!i.includes(e))return!1;if(this.p_sq_n=[t,this.EB[t]],this.n_p_sq_n=[e,this.EB[e]],this.hist_move.push(this.move_encode(t,e)),[0,1].includes(this.pl_type(t))){var n=(__BORANK[this.pl_type(t)][this.piece(t)<5?0:1]<<4)+(this.EB[t]>>4&7)+8;this.EB[n]=e}return 0!=this.pl_type(e)&&1!=this.pl_type(e)||(n=(__BORANK[this.pl_type(e)][this.piece(e)<5?0:1]<<4)+(this.EB[e]>>4&7)+8,this.EB[n]=t),this.EB[e]=this.EB[t],this.EB[t]=EMPTY_SQ,this.sq_n=null,this.future_move=[],this.turn=this.invert(this.turn,1),!0}undo_one(){this.now_undo&&this.redo(),this.now_redo&&this.undo()}redo(){if(0==this.future_move.length)return!1;var t=this.future_move.pop(),e=(t=this.move_decode(t))[0],i=t[1];this.hist_move.push(this.move_encode(e[0],i[0]));this.p_sq_n,this.EB[this.p_sq_n[0]],this.n_p_sq_n,this.EB[this.n_p_sq_n[0]];if([0,1].includes(this.pl_type(e[0]))){var _=(__BORANK[this.pl_type(e[0])][this.piece(e[0])<5?0:1]<<4)+(this.EB[e[0]]>>4&7)+8;this.EB[_]=e[0]}if([0,1].includes(this.pl_type(i[0]))){_=(__BORANK[this.pl_type(i[0])][this.piece(i[0])<5?0:1]<<4)+(this.EB[i[0]]>>4&7)+8;this.EB[_]=i[0]}return this.EB[e[0]]=e[1],this.EB[i[0]]=i[1],this.now_redo=!0,this.turn=this.invert(this.turn,1),!0}undo(){if(0==this.hist_move.length)return!1;var t=this.hist_move.pop(),e=(t=this.move_decode(t))[0],i=t[1];this.future_move.push(this.move_encode(e[0],i[0]));this.p_sq_n,this.EB[this.p_sq_n[0]],this.n_p_sq_n,this.EB[this.n_p_sq_n[0]];if([0,1].includes(this.pl_type(e[0]))){var _=(__BORANK[this.pl_type(e[0])][this.piece(e[0])<5?0:1]<<4)+(this.EB[e[0]]>>4&7)+8;this.EB[_]=i[0]}if([0,1].includes(this.pl_type(i[0]))){_=(__BORANK[this.pl_type(i[0])][this.piece(i[0])<5?0:1]<<4)+(this.EB[i[0]]>>4&7)+8;this.EB[_]=e[0]}return this.EB[e[0]]=e[1],this.EB[i[0]]=i[1],this.now_undo=!0,this.turn=this.invert(this.turn,1),!0}eval(){for(var t=0,e=0;e<2;e++){var i=1&e;if(e==i)for(var _=0;_<2;_++)for(var s=__BORANK[e][_],n=0;n<8;n++){var r=127&this.EB[s<<4|n|8];if(this.piece_area(r))t+=this.valid_moves(r,null,i,!0).length}}return t+0}next_move(t=0,e=0,i=5,_=this.turn){if(0==i)return{score:this.eval(),sq_n:t&x88_MASK,n_sq_n:e&x88_MASK};for(var s=null,n=0,r=null,o={score:1e6,sq_n:0,n_sq_n:0},h=[],a=[],c=0;c<2;c++)for(var l=__BORANK[_][c],d=8;d<16;d++)if(s=this.EB[(l<<4)+d]&x88_MASK,this.piece_area(s))for(var u=this.valid_moves(s,null,_,!0),E=0;E<u.length;E++){this.move(s,u[E],u);r=this.next_move(s,u[E],i-1,_);this.undo();a.push([r,n]),r.score>o.score&&0==_?h=[[o=r,n=c]]:r.score==o.score?h.push([r,n]):r.score<o.score&&1==_&&(h=[[o=r,n=c]])}return{score:(o=h[Math.floor(Math.random()*h.length)][0]).score,sq_n:o.sq_n,n_sq_n:o.n_sq_n}}get_all_moves(t){for(var e=[],i=0;i<2;i++)for(var _=__BORANK[t][i],s=8;s<16;s++){var n=this.EB[(_<<4)+s];if(this.piece_area(n)){var r=this.valid_moves(n,null,t,!0,!0);Array.prototype.push.apply(e,r)}}return e.sort((t,e)=>this.piece(this.EB[t&x88_MASK])<this.piece(this.EB[e&x88_MASK]))}valid_moves(t,e=null,i=this.turn,_=!1,s=!1){if(!this.piece_area(t))return[];var n=[],r=this.piece(t);return this.pl_type(t)!=i?[]:(0==r?n=e?this.king_moves(t,e):this.king_moves(t):1==r?n=e?this.queen_moves(t,e):this.queen_moves(t):2==r?n=e?this.rook_moves(t,e):this.rook_moves(t):3==r?n=e?this.bishop_moves(t,e):this.bishop_moves(t):4==r?n=e?this.horse_moves(t,e):this.horse_moves(t):5==r?n=e?this.pawn_moves(t,e):this.pawn_moves(t):console.log("ERR MOVE"),this.sq_n=t,_?(this.val_moves=n.moves.map(t=>t&x88_MASK),s?n.moves:this.val_moves):n)}king_moves(t,e=__DIR_OFFFSET.KING,i=this.turn){if(!this.piece_area(t))return[];var _,s=[],n=[],r=(__PIECE_VALUE[this.piece(t,!0)],this.pl_type(t)),o=0;return e.forEach(e=>{o=t;for(var i=0;i<__RANGE.KING;i++){if(o+=e,!(_=this.go_to_square_if_can(o,r,s))&&this.pl_type(o)==this.invert(r,1)){var h=__PIECE_VALUE[this.piece(o,!0)];n.push(-1*h);break}if(!_)break}}),{moves:s.map(e=>t<<x88_BITS|e&x88_MASK),score:n}}queen_moves(t,e=__DIR_OFFFSET.QUEEN){if(!this.piece_area(t))return[];var i,_=[],s=[],n=(__PIECE_VALUE[this.piece(t,!0)],this.pl_type(t)),r=0;return e.forEach(e=>{r=t;for(var o=0;o<__RANGE.QUEEN;o++){if(r+=e,!(i=this.go_to_square_if_can(r,n,_))&&this.pl_type(r)==this.invert(n,1)){var h=__PIECE_VALUE[this.piece(r,!0)];s.push(-1*h);break}if(!i)break}}),{moves:_.map(e=>t<<x88_BITS|e&x88_MASK),score:s}}rook_moves(t,e=__DIR_OFFFSET.ROOK,i=this.turn){if(!this.piece_area(t))return[];var _,s=[],n=[],r=(__PIECE_VALUE[this.piece(t,!0)],this.pl_type(t)),o=0;return e.forEach(e=>{o=t;for(var i=0;i<__RANGE.ROOK;i++){if(o+=e,!(_=this.go_to_square_if_can(o,r,s))&&this.pl_type(o)==this.invert(r,1)){var h=__PIECE_VALUE[this.piece(o,!0)];n.push(-1*h);break}if(!_)break}}),{moves:s.map(e=>t<<x88_BITS|e&x88_MASK),score:n}}bishop_moves(t,e=__DIR_OFFFSET.BISHOP,i=this.turn){if(!this.piece_area(t))return[];var _,s=[],n=[],r=(__PIECE_VALUE[this.piece(t,!0)],this.pl_type(t)),o=0;return e.forEach(e=>{o=t;for(var i=0;i<__RANGE.BISHOP;i++){if(o+=e,!(_=this.go_to_square_if_can(o,r,s))&&this.pl_type(o)==this.invert(r,1)){var h=__PIECE_VALUE[this.piece(o,!0)];n.push(-1*h);break}if(!_)break}}),{moves:s.map(e=>t<<x88_BITS|e&x88_MASK),score:n}}horse_moves(t,e=__DIR_OFFFSET.HORSE,i=this.turn){if(!this.piece_area(t))return[];for(var _=[],s=[],n=(__PIECE_VALUE[this.piece(t,!0)],this.pl_type(t)),r=0,o=0;o<e.length;o++)if(r=t+e[o],this.go_to_square_if_can(r,n,_)||this.pl_type(r)!=this.invert(n,1));else{var h=__PIECE_VALUE[this.piece(r,!0)];s.push(-1*h)}return{moves:_.map(e=>t<<x88_BITS|e&x88_MASK),score:s}}pawn_moves(t,e=__DIR_OFFFSET.PAWN,i=this.turn){if(!this.piece_area(t))return[];var _,s,n,r=this.pl_type(t),o=[],h=[0,0],a=(__PIECE_VALUE[this.piece(t,!0)],0),c=e.length;if(e!=__DIR_OFFFSET.PAWN){for(var l=0;l<3-c;l++)e.push(24);e.sort((t,e)=>t>e?t:e),c=3}var d=5==this.piece(t,!0)?1:-1,u=this.rank(t)==__P_RANK[r]?2:1;if(s=t+d*e[c-3],n=this.pl_type(s)!=EMPTY_SQ_TYPE,!(_=this.go_to_square_if_can(s,r,o,n))&&this.pl_type(s)==this.invert(r,1)){a=__PIECE_VALUE[this.piece(s,!0)];h.push(-1*a)}if(s=t+d*e[c-2],n=this.pl_type(s)==EMPTY_SQ_TYPE,_=this.go_to_square_if_can(s,r,o,n),2==u&&_&&(s=t+32*d,n=this.pl_type(s)==EMPTY_SQ_TYPE,_=this.go_to_square_if_can(s,r,o,n)),s=t+d*e[c-1],n=this.pl_type(s)!=EMPTY_SQ_TYPE,!(_=this.go_to_square_if_can(s,r,o,n))&&this.pl_type(s)==this.invert(r,1)){a=__PIECE_VALUE[this.piece(s,!0)];h.push(-1*a)}return{moves:o.map(e=>t<<x88_BITS|e&x88_MASK),score:h}}go_to_square_if_can(t,e,i=[],_=!0){if(!_)return!1;var s=this.pl_type(t);return 3!=s&&(2==s?(i.push(t),!0):s!=e&&(i.push(t),!1))}if_attacked(t){var e,i=this.invert(this.turn,1),_=[],s=[],n=[];this.turn=this.invert(this.turn,1);for(var r=0;r<2;r++)for(var o=__BORANK[i][r],h=8;h<16;h++)if(e=this.EB[16*o+h],this.piece_area(e)){var a=this._direction(e,t)>>1;-1!=a&&(_=this.valid_moves(e,!1,[__DIR_OFFFSET_ARR[this.piece(e,!0)][a]]),this.piece(e),_.includes(t)&&(s.push(e),Array.prototype.push.apply(n,_),n.push(e)))}return this.turn=this.invert(this.turn,1),{attackers:s,moves:n}}go_in_direction(t,e){}_direction(t,e){if(!this.piece_area(t)||!this.piece_area(e))return-1;var i=e-t;return 0==this._y(i)&&this._x(i)>0?0:18==i?1:i%17==0&&i>0?2:33==i?3:i%8==0&&i>0?4:31==i?5:i%15==0&&i>0?6:15==i?7:0==this._y(i)&&this._x(i)<0?8:-18==i?9:-1*i%17==0?10:-33==i?11:-1*i%8==0?12:-31==i?13:-1*i%15==0?14:-14==i?15:-1}}function array2D(t,e,i=null){let _=new Array(t);for(let s=0;s<t;s++){_[s]=new Array(e);for(let t=0;t<e;t++)_[s][t]=i}return _}function square_name(t,e=null,i="NORMAL"){if(null==e){var _=__BTYPE_MOD[i];t%=_,e=Math.floor(e/_)}return __STANDARD[0][t]+__STANDARD[1][e]}function sq_color(t,e=null,i="NORMAL"){return 0}function intersect(t,e){return t.filter(t=>e.includes(t))}function minus(t,e){return t.filter(t=>!e.includes(t))}const E={Board:Board,Piece:Piece,Engine:Engine,Square:Square,__PIECES_STD:__PIECES_STD,__PIECES_ID:__PIECES_ID,BOARD_MASK:BOARD_MASK,PIECE_MASK:15,PIECE_INFO_MASK:PIECE_INFO_MASK,PIECE_INFO_BITS:PIECE_INFO_BITS,PIECE_BITS:4,x88_MASK:x88_MASK,x88_MOVE_BITS:x88_MOVE_BITS,x88_MOVE_MASK:16383,x88_BITS:x88_BITS,DEAD:8,DIR_OFF_INV:0,EMPTY_SQ_TYPE:EMPTY_SQ_TYPE,EMPTY_SQ:EMPTY_SQ,INVALID_SQ:7,__RANGE:__RANGE,__BORANK:__BORANK,__RANGE_ARR:__RANGE_ARR,__DIRECTION:__DIRECTION,__DIR_LENGTH:__DIR_LENGTH,__HORSE_MOVES_OFFSET:__HORSE_MOVES_OFFSET,__DIR_OFFFSET_M:__DIR_OFFFSET_M,__DIR_OFFFSET:__DIR_OFFFSET,__DIR_OFFFSET_ARR:__DIR_OFFFSET_ARR,__P_RANK:__P_RANK,__DIRECTION_ARR:__DIRECTION_ARR,__PIECE_VALUE:__PIECE_VALUE,PIECE_VALUE_MASK:511,__PIECE_SQ:null,__PIECE_INFL:__PIECE_INFL,__PIECE:__PIECE,__CLASSIC:__CLASSIC,__STANDARD:__STANDARD,__BTYPE_MOD:__BTYPE_MOD,__STYLE:__STYLE,FUNCTION_START:FUNCTION_START,FUNCTION_END:FUNCTION_END,sq_color:sq_color,intersect:intersect,minus:minus,square_name:square_name};class Component{constructor(t){this.props=t,this.statex=t.statex}setState(){this.statex.update=!0;var t=new Event("update"),e=document.getElementsByTagName("body")[0];e.addEventListener("update",Game.update_all(this)),e.dispatchEvent(t)}}class UiSquare extends Component{constructor(t){super(t),this.sq_id=t.sq_id,this.piece_id=this.set_piece_id(this.sq_id),this.attacked=!1,this.state={sq_id:this.sq_id,statex:this.statex},this.divid=t.divid,this.check_if_cntrl_clicked=this.check_if_cntrl_clicked.bind(this),objects.add(this)}componentDidMount(){console.debug("Basic Square Mounted with HTML"),this.draw_name(),this.attacked&&this.highlight_square()}componentDidUpdate(){this.clear(),this.draw_name(),this.attacked&&this.highlight_square()}shouldComponentUpdate(){return this.check_if_cntrl_clicked(),this.set_piece_id(this.sq_id),this.attacked=this.statex.contains(this.sq_id),!0}check_if_cntrl_clicked(){"nan"!=this.statex.cntrl.type&&(this.statex.board.eboard.cntrl(this.statex.cntrl.type),this.statex.set_cntrl("nan"),this.setState())}clicked_square(){this.statex.set_sq_n(this.sq_id),this.statex.move()}clear(){const t=document.getElementById(`${this.sq_name()}`);t.getContext("2d").clearRect(0,0,t.width,t.height)}draw_square(){let t=this.sq_id;var e;e=1&(t.f^t.r)?config.WHITE:config.BLACK;const i=document.getElementById(`${this.sq_name()}`);console.info(`canvas : ${i}`);const _=i.getContext("2d");_.fillStyle=e,_.fillRect(0,0,i.width,i.height)}highlight_square(){const t=document.getElementById(`${this.sq_name()}`),e=t.getContext("2d");var i=t.width/2,_=t.height/2;e.arc(i,_,.3*i,0,2*Math.PI),e.fillStyle=config.HIGHLIGHT,e.fill()}draw_name(){const t=document.getElementById(`${this.sq_name()}`).getContext("2d");t.fillStyle="#000",t.font="12px Courier",t.fillText(this.sq_name(),converter.vh2px(.5),this.props.height-converter.vh2px(.8)),t.fillText(this.sq_name("x88"),this.props.width-converter.vh2px(4),this.props.height-converter.vh2px(.8))}sq_color(){let t=this.props.sq_id;return constant.bw_cname[1&~(t.f^t.r)]}set_piece_id(t){return this.piece_id=this.statex.board.eboard.board[t.r][t.f].piece.piece_id,this.piece_id}sq_name(t="8x8"){let e=this.props.sq_id;return"8x8"==t?constant.FILE[e.f]+e.r.toString():"x88"==t?e.r<<4|e.f:void 0}rerender(){document.getElementById(`${this.sq_name()}-svg`).innerHTML=`${SVG.piece_svg(this.piece_id,50)}`}render(){return`<div id = '${this.sq_name()}-square' class = ${this.sq_color()} onClick = 'Click.clicked_square(${this.sq_id.r}, ${this.sq_id.f})' style = 'width: ${config.SQ_SIZE}px; height:${config.SQ_SIZE}px; margin:-4px;'>\n                    <div id = '${this.sq_name()}-svg' class= "posi" style="position:absolute;width:${config.SQ_SIZE}px;height:${config.SQ_SIZE}px;"> ${SVG.piece_svg(this.piece_id,50)}</div>\n                    <canvas ref = "canvas" id = ${this.sq_name()} className= 'posi' width = ${this.props.width} height =${this.props.height} style="position:absolute"/>\n                </div>`}}class UiBoard extends Component{constructor(t){super(t),this.divid=t.id,this.eboard=new E.Board,this.state={engine:this.eboard,statex:this.statex},this.statex=new State(this),this.clicked_board=this.clicked_board.bind(this),this.check_if_cntrl_clicked=this.check_if_cntrl_clicked.bind(this),objects.add(this),config.set_sq_size({id:this.divid}),this.ui_board=this.init_ui_board()}init_ui_board(){let t=[];console.debug(`divid : ${this.divid}`);for(var e=0;e<8;e++){t.push([]);for(var i=0;i<8;i++)t[e].push(new UiSquare({sq_id:{r:i,f:e},statex:this.statex,width:config.SQ_SIZE,height:config.SQ_SIZE,color:null,divid:this.divid}))}return t}componentDidMount(){for(var t=0;t<this.ui_board.length;t++)for(var e=0;e<this.ui_board.length;e++)this.ui_board[t][e].componentDidMount()}componentDidUpdate(){}shouldComponentUpdate(){return!0}check_if_cntrl_clicked(){"nan"!=this.statex.cntrl.type&&(this.eboard.cntrl(this.statex.cntrl.type),this.statex.set_cntrl("nan"),this.setState())}clicked_board(){this.eboard.move(this.statex.sq_n.r,this.statex.sq_n.f);var t=this.eboard.valid_moves(this.statex.sq_n.r,this.statex.sq_n.f);this.statex.set_valid_moves(t),this.statex=this.statex.get(),this.setState()}draw_row(t){let e=[];for(var i=0;i<8;i++)e.push(`<div style = "display:inline-block;">\n                    ${this.ui_board[i][t].render()}\n                </div>`);return e.join("")}draw_board(){let t=[];for(var e=7;e>=0;e--)t.push(`<div>\n                    ${this.draw_row(e)}\n                </div>`);return t.join("")}uistring(){for(var t=this.draw_board(),e="",i=0;i<t.length;i++)for(var _=0;_<t[i].length;_++)e+=t[i][_];return e}render(){return console.debug(),`<div >\n                    ${this.uistring()} \n                </div>`}}class Game{constructor(t){this.mount_board(t.id),games.push(this)}static update_all(t){for(var e in games)games[e].update(t)}mount_board(t){this.board=new UiBoard(props={id:t}),this.config=JSON.parse(JSON.stringify(config)),this.config.BOARD=this.board,$("#test").html(this.board.render()),this.board.componentDidMount()}update(t){for(var e in t.ui_board)for(var i in t.ui_board[e])t.ui_board[e][i].shouldComponentUpdate()&&(t.ui_board[e][i].rerender(),t.ui_board[e][i].componentDidUpdate())}move(){var t=this.board_index(i,j);i=t.x,j=t.y,this.board.move(i,j),this.hold_flag=!this.hold_flag,this.board.valid_moves(i,j)}valid_moves(){var t=this.board_index(i,j);i=t.x,j=t.y,this.hold_flag=!this.hold_flag,this.board.valid_moves(i,j)}}